SELECT
    -- drop name when the item is a POI - in that case the name
    -- probably refers to the POI. instead, we can use the house
    -- name tag, if it has been set. likewise for landuse areas
    -- where we might want to label the landuse rather than the
    -- building.
    CASE WHEN mz_poi_min_zoom IS NULL AND mz_landuse_min_zoom IS NULL
         THEN name
         ELSE "addr:housename"
    END AS name,
    way_area::bigint AS area,
    osm_id AS __id__,
    'openstreetmap.org' AS source,
    mz_calculate_output_buildings(planet_osm_polygon.*) AS mz_properties,
    {% filter geometry %}way{% endfilter %} AS __geometry__,
    %#tags AS tags

FROM
    planet_osm_polygon

WHERE

    {{ bounds|bbox_filter('way') }} AND
    mz_building_min_zoom <= {{ zoom }}

{% if zoom >= 16 %}

UNION ALL

SELECT
    name,
    NULL AS area,
    osm_id AS __id__,
    'openstreetmap.org' AS source,
    mz_calculate_output_buildings(planet_osm_point.*) AS mz_properties,
    {% filter geometry %}way{% endfilter %} AS __geometry__,
    %#tags AS tags

FROM
    planet_osm_point

WHERE

    {{ bounds|bbox_filter('way') }} AND
    mz_building_min_zoom <= {{ zoom }}

{% endif %}
